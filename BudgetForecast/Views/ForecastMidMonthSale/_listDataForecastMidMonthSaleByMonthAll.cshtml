@using BudgetForecast.Model;
@{
    ViewBag.Title = "_listDataForcastMidMonthSale";
    var arrMonth = @ViewBag.monthList;
    string codeColorMonthCurrent = "#f9ecdc";
    int monthInputCurrent = 0;
    string setHeight = "980px";
    string setHeightCustomer = "920px";
    string name1 = Environment.MachineName; //returns webserver
    string name2 = System.Net.Dns.GetHostName(); //returns webserver
                                                 // string name3 = System.Windows.Forms.SystemInformation.ComputerName; //returns webserver
    string name4 = System.Environment.GetEnvironmentVariable("COMPUTERNAME").ToString();//returns webserver

    var monthSplits = @ViewBag.MonthYearList[0].Text.Split('-');
    monthInputCurrent = int.Parse(monthSplits[0]);
    string formattedMonthInputCurrent = monthInputCurrent.ToString("00");
}
@*Summary by month*@
<div class="card mb-12" style="padding-bottom: 10px;">
    <div class="card-body" style="padding: 0px 15px 0px; margin-bottom: -15px;">
        <div class="row">
            <div class="table-responsive">
                <table class="table table-striped table-bordered nowrap table-hover" border="1">
                    <thead>
                        <tr style="white-space: nowrap;">
                            <th rowspan="2" align="center" class="vcenter" style="vertical-align: middle; min-width: 210px;">Type</th>
                            <th rowspan="2" align="center" class="vcenter" style="vertical-align: middle; min-width: 100px;">Last Year</th>
                            <th rowspan="2" align="center" class="vcenter" style="vertical-align: middle; min-width: 100px;">Total</th>
                            <th rowspan="2" colspan="2" align="center" class="vcenter" style="vertical-align: middle; min-width: 190px;">Under/Over</th>
                            <th colspan="12" align="center" class="vcenter" style="vertical-align: middle;"> 2023 </th>
                        </tr>
                        <tr>

                            @{
                                foreach (var monthItemCur in @ViewBag.monthList)
                                {
                                    string bgMonthCurrent = "";
                                    if (formattedMonthInputCurrent == monthItemCur)
                                    {
                                        bgMonthCurrent = codeColorMonthCurrent;
                                    }
                                    <th class="vcenter" align="center" style="font-weight: 700; min-width: 130px; background-color: @bgMonthCurrent"> @monthItemCur </th>
                                }
                            }

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var dataItemByMonth in (List<StoreSearchForecastSaleModel>)ViewBag.sumByMonth)
                        {
                            if (dataItemByMonth.Caption != "Avg")
                            {
                                string captionText = "";
                                string captionIdLastYear = "";
                                string captionIdTotal = "";
                                string captionUnderBudget = "";
                                string captionOverBudget = "";
                                string captionByMonth = "";
                                string captiontextNew = "";

                                string colorTd = "";
                                if (dataItemByMonth.Caption == "FC")
                                {
                                    captionText = "Forecastm";
                                    captiontextNew = "Forecast";
                                    colorTd = "background-color: #ccebedc9";
                                }
                                else if (dataItemByMonth.Caption == "NewFC")
                                {
                                    captionText = "Forecast";
                                    captiontextNew = "New Forecast";
                                    colorTd = "background-color: #ccebedc9";
                                }
                                else
                                {
                                    captionText = dataItemByMonth.Caption;
                                }
                                //idLastYear
                                captionIdLastYear = "sum_last_year_" + @captionText.ToString().ToLower() + "_all";
                                captionIdTotal = "sum_total_" + @captionText.ToString().ToLower() + "_all";
                                captionUnderBudget = "sum_under_" + @captionText.ToString().ToLower() + "_all";
                                captionOverBudget = "sum_over_" + @captionText.ToString().ToLower() + "_all";



                                <tr style="white-space: nowrap;">
                                    @if (dataItemByMonth.Caption == "FC")
                                    {
                                        <td style="vertical-align: middle; @colorTd"> <b>  @captiontextNew </b> </td>
                                    }
                                    else if (dataItemByMonth.Caption == "NewFC")
                                    {
                                        <td style="vertical-align: middle; @colorTd"> <b>  @captiontextNew </b> </td>

                                    }
                                    else
                                    {
                                        <td style="vertical-align: middle; @colorTd"> <b>  @captionText </b> </td>

                                    }
                                    <td class="vright" style="vertical-align: middle; font-weight: 700; @colorTd"> <span id="@captionIdLastYear" style="font-size: 16px;"> @dataItemByMonth.Last_year.ToString("N0") </span> </td>
                                    <td class="vright" style="vertical-align: middle; font-weight: 700; @colorTd"> <span id="@captionIdTotal" style="font-size: 16px;"> @dataItemByMonth.Total_Caption.ToString("N0") </span> </td>
                                    <td class="vright" style="vertical-align: middle; font-weight: 700; min-width: 90px; @colorTd"> <span class="" id="@captionUnderBudget" style="font-size: 16px;"> 0 </span> </td>
                                    <td class="vright" style="vertical-align: middle; font-weight: 700; min-width: 90px; @colorTd"> <span class="" id="@captionOverBudget" style="font-size: 16px;"> 0 </span> </td>
                                    @foreach (string monthItemCur in @ViewBag.monthList)
                                    {
                                        string bgMonthCurrent = "";
                                        double valByMonthSumAll = 0;

                                        if (dataItemByMonth.Caption == "FC")
                                        {
                                            if (formattedMonthInputCurrent == monthItemCur)
                                            {
                                                bgMonthCurrent = codeColorMonthCurrent;
                                            }
                                            else
                                            {
                                                bgMonthCurrent = "#ccebedc9";
                                            }
                                        }
                                        else if (dataItemByMonth.Caption == "NewFC")
                                        {
                                            if (formattedMonthInputCurrent == monthItemCur)
                                            {
                                                bgMonthCurrent = codeColorMonthCurrent;
                                            }
                                            else
                                            {
                                                bgMonthCurrent = "#ccebedc9";
                                            }
                                        }
                                        else
                                        {
                                            if (formattedMonthInputCurrent == monthItemCur)
                                            {
                                                bgMonthCurrent = codeColorMonthCurrent;
                                            }
                                        }
                                        switch (monthItemCur)
                                        {
                                            case "01":
                                                valByMonthSumAll = dataItemByMonth.M01;
                                                break;
                                            case "02":
                                                valByMonthSumAll = dataItemByMonth.M02;
                                                break;
                                            case "03":
                                                valByMonthSumAll = dataItemByMonth.M03;
                                                break;
                                            case "04":
                                                valByMonthSumAll = dataItemByMonth.M04;
                                                break;
                                            case "05":
                                                valByMonthSumAll = dataItemByMonth.M05;
                                                break;
                                            case "06":
                                                valByMonthSumAll = dataItemByMonth.M06;
                                                break;
                                            case "07":
                                                valByMonthSumAll = dataItemByMonth.M07;
                                                break;
                                            case "08":
                                                valByMonthSumAll = dataItemByMonth.M08;
                                                break;
                                            case "09":
                                                valByMonthSumAll = dataItemByMonth.M09;
                                                break;
                                            case "10":
                                                valByMonthSumAll = dataItemByMonth.M10;
                                                break;
                                            case "11":
                                                valByMonthSumAll = dataItemByMonth.M11;
                                                break;
                                            case "12":
                                                valByMonthSumAll = dataItemByMonth.M12;
                                                break;
                                            default:
                                                valByMonthSumAll = 0;
                                                break;
                                        }

                                        captionByMonth = "sum_sale_" + @captionText.ToString().ToLower() + "_" + @monthItemCur.TrimStart('0') + "_all";

                                        <td class="vright" align="center" style="font-weight: 700; background-color: @bgMonthCurrent">
                                            <span class="" id="@captionByMonth" style="font-size: 16px;">
                                                @if (valByMonthSumAll != 0)
                                                {
                                                    @valByMonthSumAll.ToString("N0")
                                                }
                                                @if (dataItemByMonth.Caption == "Actual")
                                                {
                                                    <input class="" type="hidden" id="sum_input_all_actual_@monthItemCur.TrimStart('0')" value="@valByMonthSumAll.ToString("N0")" />
                                                }@if (dataItemByMonth.Caption == "FC")
                                                {
                                                    <input class="" type="hidden" data-month="@monthItemCur.TrimStart('0')" id="sum_input_all_forecastm_@monthItemCur.TrimStart('0')" value="@valByMonthSumAll.ToString("N0")" />
                                                }@if (dataItemByMonth.Caption == "NewFC")
                                                {
                                                    <input class="" type="hidden" id="sum_input_all_forecast_@monthItemCur.TrimStart('0')" value="@valByMonthSumAll.ToString("N0")" />
                                                }
                                            </span>

                                        </td>
                                    }
                                </tr>

                            }
                        }
                        <tr style="white-space: nowrap;">
                            <td style="vertical-align: middle; background-color: #cbead3;"> <b>Remaining</b> </td>
                            <td class="vright" style="vertical-align: middle; font-weight: 700; background-color: #cbead3;"> <span id="sum_last_year_remain" style="font-size: 16px;">  </span> </td>
                            <td class="vright" style="vertical-align: middle; font-weight: 700; background-color: #cbead3;"> <span id="sum_total_remain" style="font-size: 16px;">  </span> </td>
                            <td class="vright" style="vertical-align: middle; font-weight: 700; background-color: #cbead3;"> <span id="sum_under_remain" style="font-size: 16px;">  </span> </td>
                            <td class="vright" style="vertical-align: middle; font-weight: 700; background-color: #cbead3;"> <span id="sum_over_remain" style="font-size: 16px;">  </span> </td>
                            @foreach (var monthItemCur in @ViewBag.monthList)
                            {
                                string bgMonthCurrent = "#cbead3";
                                if (formattedMonthInputCurrent == monthItemCur)
                                {
                                    bgMonthCurrent = "#f9ecdc";
                                }
                                <th class="vright" align="center" style="font-weight: 700; background-color: @bgMonthCurrent;">
                                    <span class="" id="sum_sale_remain_all_@monthItemCur.TrimStart('0')" style="font-size: 16px;"> 0 </span>
                                </th>
                            }
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('[id^="sum_input_all_forecastm_"]').each(function () {
            let month = $(this).data('month');
            let sum_actual = $("#sum_input_all_actual_" + month).val().replace(/([-[\]{}()*+?\\^$|%,])/g, '') || 0;
            sum_actual = Number(sum_actual);
            let sum_new_forecast = $("#sum_input_all_forecast_" + month).val().replace(/([-[\]{}()*+?\\^$|%,])/g, '') || 0;
            sum_new_forecast = Number(sum_new_forecast);
            let sum_forecast = $(this).val().replace(/([-[\]{}()*+?\\^$|%,])/g, '') || 0;
            sum_forecast = Number(sum_forecast);
            let remain_res = 0;

            //console.log("++++++++++++++++++++++++");
            //console.log(sum_actual);
            //console.log(sum_new_forecast);
            //console.log(sum_forecast);
            //console.log(month);
            //console.log("++++++++++++++++++++++++");
            if (sum_new_forecast > 0) {
                remain_res = sum_new_forecast - sum_actual;
            }
            else {
                remain_res = sum_forecast - sum_actual;
            }
            console.log("REsult : " + sum_new_forecast + " month : " + month);
            $("#sum_sale_remain_all_" + month).text(numberWithCommas(remain_res.toFixed(0)));
        })
    });
</script>