@using BudgetForecast.Model;
@{
    ViewBag.Title = "_listDataForcastPM";
    var arrMonth = new string[] { "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan Nxt", "Feb Nxt" };
    string setWidth = "890px";
    var countList = ((List<StoreSearchForecastPmModel>)ViewBag.stkGroupList).Count();
}

<input type="hidden" id="countList" value="@countList" />
@if (((List<StoreSearchForecastPmModel>)ViewBag.stkGroupList).Count() == 1)
{
    setWidth = "790px";
}
@if (((List<StoreSearchForecastPmModel>)ViewBag.stkGroupList).Count() == 0)
{
    <div class="alert alert-danger text-center" style="font-size: 14px;"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> ไม่พบข้อมูล โปรดกำหนดเงื่อนไข แล้วกดปุ่ม "Search"</div>
}
else
{
    <div class="card">
        <form method="post" id="formForecastPm">
            <div class="card-body p-2" style="height: 790px; overflow-y: auto; max-height: @setWidth">
                @{
                    int rowSec = 0;
                    foreach (var stkGroupItem in (List<StoreSearchForecastPmModel>)ViewBag.stkGroupList)
                    {
                        //เก็บ sec
                        <input type="hidden" name="stkSecList_header[]" class="stkSecList_header" value="@stkGroupItem.SEC" />
                        rowSec++;
                        if (rowSec > 1)
                        {
                            <hr>
                        }
                        <div class="card mb-12">
                            <div class="card-header bg-info text-white font-weight-bold" onclick="hideBodySec('@stkGroupItem.SEC');" style="cursor: pointer;">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <i class="fa fa-cog fa-lg"></i> SEC (@stkGroupItem.SEC/@stkGroupItem.SECNAM)
                                        <span style="float: right; position: relative;"><i id="header_@stkGroupItem.SEC" class="fa fa-caret-down fa-lg"></i></span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body" style="padding: 0px 0px;" id="body_@stkGroupItem.SEC">
                                <div class="table-responsive">
                                    <table class="dataTablePage table dataTable table-striped table-bordered nowrap table-hover tableFixHead" border="1">
                                        <thead>
                                            <tr style="white-space: nowrap;">
                                                <th class="" style="vertical-align: middle;">Month/Topic</th>
                                                @*<th class="vcenter" style="vertical-align: middle; min-width: 130px;">Begin</th>*@
                                                @{

                                                    foreach (var item in arrMonth)
                                                    {
                                                        <th class="vcenter" align="center" style="font-weight: 700;"> @item </th>
                                                        rowSec++;
                                                    }
                                                }
                                                <th class="vcenter" style="vertical-align: middle;">Sum Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr style="white-space: nowrap;">
                                                <th style="vertical-align:middle;">Budget</th>
                                                @{
                                                    double valBudgetBegin = 0;
                                                    valBudgetBegin = stkGroupItem.BUD00;
                                                }
                                                @*<td class="vright" style="vertical-align: middle;"> </td>*@
                                                @{
                                                    int countBudget = 0;
                                                    string nameBudget = "";
                                                    string idBudgetSumTotal = "";
                                                    foreach (var item in arrMonth)
                                                    {

                                                        countBudget++;
                                                        double valBudget = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valBudget = stkGroupItem.BUD01;
                                                                break;
                                                            case "Feb":
                                                                valBudget = stkGroupItem.BUD02;
                                                                break;
                                                            case "Mar":
                                                                valBudget = stkGroupItem.BUD03;
                                                                break;
                                                            case "Apr":
                                                                valBudget = stkGroupItem.BUD04;
                                                                break;
                                                            case "May":
                                                                valBudget = stkGroupItem.BUD05;
                                                                break;
                                                            case "Jun":
                                                                valBudget = stkGroupItem.BUD06;
                                                                break;
                                                            case "Jul":
                                                                valBudget = stkGroupItem.BUD07;
                                                                break;
                                                            case "Aug":
                                                                valBudget = stkGroupItem.BUD08;
                                                                break;
                                                            case "Sep":
                                                                valBudget = stkGroupItem.BUD09;
                                                                break;
                                                            case "Oct":
                                                                valBudget = stkGroupItem.BUD10;
                                                                break;
                                                            case "Nov":
                                                                valBudget = stkGroupItem.BUD11;
                                                                break;
                                                            case "Dec":
                                                                valBudget = stkGroupItem.BUD12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameBudget = "budget_" + @stkGroupItem.SEC + "_" + @countBudget;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valBudget != 0)
                                                            {
                                                                @valBudget.ToString("N0")
                                                            }
                                                            <input data-month="@countBudget" data-stkgroup="@stkGroupItem.SEC" type="hidden" class="form-control mask vright budget_@countBudget" name="@nameBudget" id="budget_@countBudget" value="@valBudget.ToString("N0")" onkeyup="return sumForecastPmId(this.id, '@stkGroupItem.SEC');" onkeypress="return validateFloatKeyPress(this,event);" style="width: 120px;" />
                                                        </td>

                                                    }
                                                    //budget sum total
                                                    idBudgetSumTotal = "budget_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    <td class="vcenter">
                                                        <input class="form-control vright budget_sum_total" type="text" id="@idBudgetSumTotal" value="@valBudgetBegin.ToString("N0")" style="width: 120px;" disabled />
                                                    </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Accum Budget</th>
                                                @{
                                                    double valAccBudgetBegin = 0;
                                                    valAccBudgetBegin = stkGroupItem.ACM_BUD12;
                                                }
                                                @*<td class="vright" style="vertical-align: middle;">
                @valAccBudgetBegin.ToString("N0")
                    <input class="form-control vright acc_budget_0" type="hidden" id="acc_budget_0" value="@valAccBudgetBegin.ToString("N0")" />
            </td>*@

                                                @{
                                                    int countAccBudget = 0;
                                                    string nameAccBudget = "";
                                                    string idAccBudgetSumTotal = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countAccBudget++;
                                                        double valAccBudget = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valAccBudget = stkGroupItem.ACM_BUD01;
                                                                break;
                                                            case "Feb":
                                                                valAccBudget = stkGroupItem.ACM_BUD02;
                                                                break;
                                                            case "Mar":
                                                                valAccBudget = stkGroupItem.ACM_BUD03;
                                                                break;
                                                            case "Apr":
                                                                valAccBudget = stkGroupItem.ACM_BUD04;
                                                                break;
                                                            case "May":
                                                                valAccBudget = stkGroupItem.ACM_BUD05;
                                                                break;
                                                            case "Jun":
                                                                valAccBudget = stkGroupItem.ACM_BUD06;
                                                                break;
                                                            case "Jul":
                                                                valAccBudget = stkGroupItem.ACM_BUD07;
                                                                break;
                                                            case "Aug":
                                                                valAccBudget = stkGroupItem.ACM_BUD08;
                                                                break;
                                                            case "Sep":
                                                                valAccBudget = stkGroupItem.ACM_BUD09;
                                                                break;
                                                            case "Oct":
                                                                valAccBudget = stkGroupItem.ACM_BUD10;
                                                                break;
                                                            case "Nov":
                                                                valAccBudget = stkGroupItem.ACM_BUD11;
                                                                break;
                                                            case "Dec":
                                                                valAccBudget = stkGroupItem.ACM_BUD12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameAccBudget = "acc_budget_" + @stkGroupItem.SEC + "_" + @countAccBudget;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valAccBudget != 0)
                                                            {
                                                                @valAccBudget.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="form-control vright acc_budget_@countAccBudget" name="@nameAccBudget" id="acc_budget_@countAccBudget" value="@valAccBudget.ToString("N0")" />
                                                        </td>
                                                    }
                                                    <td class="vcenter">
                                                        @{
                                                            idAccBudgetSumTotal = "budget_sum_total_" + @stkGroupItem.SEC + "_0";
                                                        }
                                                        <input class="form-control vright acc_budget_sum_total" type="text" id="@idAccBudgetSumTotal" value="@stkGroupItem.ACM_BUD12.ToString("N0")" style="width: 120px;" disabled />
                                                    </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Budget GP</th>
                                                @*<td class="vright"> </td>*@
                                                @{
                                                    int countBudgetGp = 0;
                                                    string idBudgetGpSumTotal = "";
                                                    string namebudgetGp = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countBudgetGp++;
                                                        double valBudgetGp = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valBudgetGp = stkGroupItem.GP_BUD01;
                                                                break;
                                                            case "Feb":
                                                                valBudgetGp = stkGroupItem.GP_BUD02;
                                                                break;
                                                            case "Mar":
                                                                valBudgetGp = stkGroupItem.GP_BUD03;
                                                                break;
                                                            case "Apr":
                                                                valBudgetGp = stkGroupItem.GP_BUD04;
                                                                break;
                                                            case "May":
                                                                valBudgetGp = stkGroupItem.GP_BUD05;
                                                                break;
                                                            case "Jun":
                                                                valBudgetGp = stkGroupItem.GP_BUD06;
                                                                break;
                                                            case "Jul":
                                                                valBudgetGp = stkGroupItem.GP_BUD07;
                                                                break;
                                                            case "Aug":
                                                                valBudgetGp = stkGroupItem.GP_BUD08;
                                                                break;
                                                            case "Sep":
                                                                valBudgetGp = stkGroupItem.GP_BUD09;
                                                                break;
                                                            case "Oct":
                                                                valBudgetGp = stkGroupItem.GP_BUD10;
                                                                break;
                                                            case "Nov":
                                                                valBudgetGp = stkGroupItem.GP_BUD11;
                                                                break;
                                                            case "Dec":
                                                                valBudgetGp = stkGroupItem.GP_BUD12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        namebudgetGp = "budget_gp_" + @stkGroupItem.SEC + "_" + countBudgetGp;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valBudgetGp != 0)
                                                            {
                                                                @valBudgetGp.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="form-control vright budget_gp_@countBudgetGp" name="@namebudgetGp" id="budget_gp_@countBudgetGp" value="@valBudgetGp.ToString("N0")" />
                                                        </td>
                                                    }
                                                    idBudgetGpSumTotal = "budget_gp_per_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    //sum total budget gp
                                                    <td class="vcenter">
                                                        <input class="form-control vright budget_gp_sum_total" type="text" id="@idBudgetGpSumTotal" value="@stkGroupItem.GP_BUD00.ToString("N0")" style="width: 120px;" disabled />
                                                    </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Accum Bdg GP</th>
                                                @*<td class="vright"> </td>*@
                                                @{
                                                    int countAccBudgetGp = 0;
                                                    string idAccBudgetGpSumTotal = "";
                                                    string nameAccBudgetGp = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countAccBudgetGp++;
                                                        double valAccBudgetGp = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD01;
                                                                break;
                                                            case "Feb":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD02;
                                                                break;
                                                            case "Mar":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD03;
                                                                break;
                                                            case "Apr":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD04;
                                                                break;
                                                            case "May":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD05;
                                                                break;
                                                            case "Jun":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD06;
                                                                break;
                                                            case "Jul":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD07;
                                                                break;
                                                            case "Aug":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD08;
                                                                break;
                                                            case "Sep":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD09;
                                                                break;
                                                            case "Oct":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD10;
                                                                break;
                                                            case "Nov":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD11;
                                                                break;
                                                            case "Dec":
                                                                valAccBudgetGp = stkGroupItem.ACM_GPBUD12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameAccBudgetGp = "acc_budget_gp_" + @stkGroupItem.SEC + "_" + countBudgetGp;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valAccBudgetGp != 0)
                                                            {
                                                                @valAccBudgetGp.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="acc_budget_gp_@countAccBudgetGp" name="@nameAccBudgetGp" id="acc_budget_gp_@countAccBudgetGp" value="@valAccBudgetGp.ToString("N0")" />
                                                        </td>
                                                    }
                                                    //sum total accum budget gp
                                                    idAccBudgetGpSumTotal = "acc_budget_gp_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    <td class="vcenter"> <input class="form-control vright acc_budget_gp_sum_total" type="text" id="@idAccBudgetGpSumTotal" value="@stkGroupItem.ACM_GPBUD12.ToString("N0")" style="width: 120px;" disabled /> </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">%Budget GP</th>
                                                @{
                                                    double valBeginBudgetGpPer = 0;
                                                    valBeginBudgetGpPer = (stkGroupItem.GP_BUD00 / stkGroupItem.BUD00) * 100;
                                                    if (!Double.IsNaN(valBeginBudgetGpPer) && valBeginBudgetGpPer != 0)
                                                    {
                                                        valBeginBudgetGpPer = valBeginBudgetGpPer;
                                                    }
                                                    else
                                                    {
                                                        valBeginBudgetGpPer = 0;
                                                    }

                                                }
                                                @*<td class="vright"> </td>*@
                                                @{
                                                    int countBudgetGpPer = 0;
                                                    int sizeBudgetValGpPer;
                                                    string idBudgetGpPerSumTotal = "";
                                                    string nameBudgetGpPer = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countBudgetGpPer++;
                                                        double valBudgetGpPer = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD01 / stkGroupItem.BUD01) * 100;
                                                                break;
                                                            case "Feb":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD02 / stkGroupItem.BUD02) * 100;
                                                                break;
                                                            case "Mar":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD03 / stkGroupItem.BUD03) * 100;
                                                                break;
                                                            case "Apr":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD04 / stkGroupItem.BUD04) * 100;
                                                                break;
                                                            case "May":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD05 / stkGroupItem.BUD05) * 100;
                                                                break;
                                                            case "Jun":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD06 / stkGroupItem.BUD06) * 100;
                                                                break;
                                                            case "Jul":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD07 / stkGroupItem.BUD07) * 100;
                                                                break;
                                                            case "Aug":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD08 / stkGroupItem.BUD08) * 100;
                                                                break;
                                                            case "Sep":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD09 / stkGroupItem.BUD09) * 100;
                                                                break;
                                                            case "Oct":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD10 / stkGroupItem.BUD10) * 100;
                                                                break;
                                                            case "Nov":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD11 / stkGroupItem.BUD11) * 100;
                                                                break;
                                                            case "Dec":
                                                                valBudgetGpPer = (stkGroupItem.GP_BUD12 / stkGroupItem.BUD12) * 100;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameBudgetGpPer = "budget_gp_per_" + @stkGroupItem.SEC + "_" + countBudgetGpPer;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valBudgetGpPer != 0 && !Double.IsNaN(valBudgetGpPer))
                                                            {
                                                                sizeBudgetValGpPer = valBudgetGpPer.ToString("N0").Length;
                                                                @valBudgetGpPer.ToString("N0").Insert(sizeBudgetValGpPer, "%");
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="form-control vright budget_gp_per_@countBudgetGpPer" name="@nameBudgetGpPer" id="budget_gp_per_@countBudgetGpPer" value="@valBudgetGpPer.ToString("N0")" />
                                                        </td>
                                                    }
                                                    idBudgetGpPerSumTotal = "budget_gp_per_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    //sum total budget gp per
                                                    <td class="vcenter">
                                                        <input class="form-control vright budget_gp_per_sum_total" type="text" id="@idBudgetGpPerSumTotal" value="@valBeginBudgetGpPer.ToString("N2")%" style="width: 120px;" disabled />
                                                    </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Actual</th>
                                                @*<td>  </td>*@
                                                @{
                                                    int countAct = 0;
                                                    string idActSumTotal = "";
                                                    string nameAct = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countAct++;
                                                        double valAct = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valAct = stkGroupItem.ACT01;
                                                                break;
                                                            case "Feb":
                                                                valAct = stkGroupItem.ACT02;
                                                                break;
                                                            case "Mar":
                                                                valAct = stkGroupItem.ACT03;
                                                                break;
                                                            case "Apr":
                                                                valAct = stkGroupItem.ACT04;
                                                                break;
                                                            case "May":
                                                                valAct = stkGroupItem.ACT05;
                                                                break;
                                                            case "Jun":
                                                                valAct = stkGroupItem.ACT06;
                                                                break;
                                                            case "Jul":
                                                                valAct = stkGroupItem.ACT07;
                                                                break;
                                                            case "Aug":
                                                                valAct = stkGroupItem.ACT08;
                                                                break;
                                                            case "Sep":
                                                                valAct = stkGroupItem.ACT09;
                                                                break;
                                                            case "Oct":
                                                                valAct = stkGroupItem.ACT10;
                                                                break;
                                                            case "Nov":
                                                                valAct = stkGroupItem.ACT11;
                                                                break;
                                                            case "Dec":
                                                                valAct = stkGroupItem.ACT12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameAct = "act_" + @stkGroupItem.SEC + "_" + countAct;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valAct != 0)
                                                            {
                                                                @valAct.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="act_@countAct" name="@nameAct" id="act_@countAct" value="@valAct.ToString("N0")" />
                                                        </td>
                                                    }
                                                    idActSumTotal = "act_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    //sum total actual
                                                    <td class="vcenter">  <input class="form-control vright act_sum_total" type="text" id="@idActSumTotal" value="@stkGroupItem.ACT00.ToString("N0")" style="width: 120px;" disabled />  </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Accum Actual</th>
                                                @*<td>  </td>*@
                                                @{
                                                    int countAccAct = 0;
                                                    string idAccActSumTotal = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countAccAct++;
                                                        double valAccAct = 0;
                                                        string nameAccAct = "";
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valAccAct = stkGroupItem.ACM_ACT01;
                                                                break;
                                                            case "Feb":
                                                                valAccAct = stkGroupItem.ACM_ACT02;
                                                                break;
                                                            case "Mar":
                                                                valAccAct = stkGroupItem.ACM_ACT03;
                                                                break;
                                                            case "Apr":
                                                                valAccAct = stkGroupItem.ACM_ACT04;
                                                                break;
                                                            case "May":
                                                                valAccAct = stkGroupItem.ACM_ACT05;
                                                                break;
                                                            case "Jun":
                                                                valAccAct = stkGroupItem.ACM_ACT06;
                                                                break;
                                                            case "Jul":
                                                                valAccAct = stkGroupItem.ACM_ACT07;
                                                                break;
                                                            case "Aug":
                                                                valAccAct = stkGroupItem.ACM_ACT08;
                                                                break;
                                                            case "Sep":
                                                                valAccAct = stkGroupItem.ACM_ACT09;
                                                                break;
                                                            case "Oct":
                                                                valAccAct = stkGroupItem.ACM_ACT10;
                                                                break;
                                                            case "Nov":
                                                                valAccAct = stkGroupItem.ACM_ACT11;
                                                                break;
                                                            case "Dec":
                                                                valAccAct = stkGroupItem.ACM_ACT12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameAccAct = "act_" + @stkGroupItem.SEC + "_" + countAccAct;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valAccAct != 0)
                                                            {
                                                                @valAccAct.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="form-control vright acc_act_@countAccAct" name="@nameAccAct" id="acc_act_@countAccAct" value="@valAccAct.ToString("N0")" />
                                                        </td>
                                                    }
                                                    idAccActSumTotal = "acc_act_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    //sum total acc actual
                                                    <td class="vcenter">  <input class="form-control vright acc_act_sum_total" type="text" id="@idAccActSumTotal" value="@stkGroupItem.ACM_ACT12.ToString("N0")" style="width: 120px;" disabled />  </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Actual GP</th>
                                                @*<td class="vright">  </td>*@
                                                @{
                                                    int countActGp = 0;
                                                    string idActGpSumTotal = "";
                                                    string nameActGp = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countActGp++;
                                                        double valActGp = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valActGp = stkGroupItem.GP_ACT01;
                                                                break;
                                                            case "Feb":
                                                                valActGp = stkGroupItem.GP_ACT02;
                                                                break;
                                                            case "Mar":
                                                                valActGp = stkGroupItem.GP_ACT03;
                                                                break;
                                                            case "Apr":
                                                                valActGp = stkGroupItem.GP_ACT04;
                                                                break;
                                                            case "May":
                                                                valActGp = stkGroupItem.GP_ACT05;
                                                                break;
                                                            case "Jun":
                                                                valActGp = stkGroupItem.GP_ACT06;
                                                                break;
                                                            case "Jul":
                                                                valActGp = stkGroupItem.GP_ACT07;
                                                                break;
                                                            case "Aug":
                                                                valActGp = stkGroupItem.GP_ACT08;
                                                                break;
                                                            case "Sep":
                                                                valActGp = stkGroupItem.GP_ACT09;
                                                                break;
                                                            case "Oct":
                                                                valActGp = stkGroupItem.GP_ACT10;
                                                                break;
                                                            case "Nov":
                                                                valActGp = stkGroupItem.GP_ACT11;
                                                                break;
                                                            case "Dec":
                                                                valActGp = stkGroupItem.GP_ACT12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameActGp = "act_gp_" + @stkGroupItem.SEC + "_" + countActGp;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valActGp != 0)
                                                            {
                                                                @valActGp.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="act_gp_@countActGp" name="@nameActGp" id="act_gp_@countActGp" value="@valActGp.ToString("N0")" />
                                                        </td>
                                                    }
                                                    idActGpSumTotal = "act_gp_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    //sum total act gp
                                                    <td class="vcenter">
                                                        @* @stkGroupItem.GP_ACT00.ToString("N0")*@
                                                        <input class="form-control vright act_gp_sum_total" type="text" id="@idActGpSumTotal" value="@stkGroupItem.GP_ACT00.ToString("N0")" style="width: 120px;" disabled />
                                                    </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">Accum Act GP</th>
                                                @*<td class="vright">  </td>*@
                                                @{
                                                    int countAccActGp = 0;
                                                    string idAccActGpSumTotal = "";
                                                    string nameAccActGp = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countAccActGp++;
                                                        double valAccActGp = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valAccActGp = stkGroupItem.ACM_AGP01;
                                                                break;
                                                            case "Feb":
                                                                valAccActGp = stkGroupItem.ACM_AGP02;
                                                                break;
                                                            case "Mar":
                                                                valAccActGp = stkGroupItem.ACM_AGP03;
                                                                break;
                                                            case "Apr":
                                                                valAccActGp = stkGroupItem.ACM_AGP04;
                                                                break;
                                                            case "May":
                                                                valAccActGp = stkGroupItem.ACM_AGP05;
                                                                break;
                                                            case "Jun":
                                                                valAccActGp = stkGroupItem.ACM_AGP06;
                                                                break;
                                                            case "Jul":
                                                                valAccActGp = stkGroupItem.ACM_AGP07;
                                                                break;
                                                            case "Aug":
                                                                valAccActGp = stkGroupItem.ACM_AGP08;
                                                                break;
                                                            case "Sep":
                                                                valAccActGp = stkGroupItem.ACM_AGP09;
                                                                break;
                                                            case "Oct":
                                                                valAccActGp = stkGroupItem.ACM_AGP10;
                                                                break;
                                                            case "Nov":
                                                                valAccActGp = stkGroupItem.ACM_AGP11;
                                                                break;
                                                            case "Dec":
                                                                valAccActGp = stkGroupItem.ACM_AGP12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameAccActGp = "act_gp_" + @stkGroupItem.SEC + "_" + countAccActGp;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valAccActGp != 0)
                                                            {
                                                                @valAccActGp.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="acc_act_gp_@countAccActGp" name="@nameAccActGp" id="acc_act_gp_@countAccActGp" value="@valAccActGp.ToString("N0")%" />
                                                        </td>
                                                    }
                                                    idAccActGpSumTotal = "acc_act_gp_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    <td class="vcenter"> <input class="form-control vright acc_act_gp_sum_total" type="text" id="@idAccActGpSumTotal" value="@stkGroupItem.ACM_AGP12.ToString("N0")" style="width: 120px;" disabled /> </td>
                                                }
                                            </tr>
                                            <tr>
                                                <th style="vertical-align:middle;">%Actual GP</th>
                                                @*<td class="vright">  </td>*@
                                                @{
                                                    int countActGpPer = 0;
                                                    int sizeActValGpPer;
                                                    string nameActGpPer = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countActGpPer++;
                                                        double valActGpPer = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valActGpPer = (stkGroupItem.GP_ACT01 / stkGroupItem.ACT01) * 100;
                                                                break;
                                                            case "Feb":
                                                                valActGpPer = (stkGroupItem.GP_ACT02 / stkGroupItem.ACT02) * 100;
                                                                break;
                                                            case "Mar":
                                                                valActGpPer = (stkGroupItem.GP_ACT03 / stkGroupItem.ACT03) * 100;
                                                                break;
                                                            case "Apr":
                                                                valActGpPer = (stkGroupItem.GP_ACT04 / stkGroupItem.ACT04) * 100;
                                                                break;
                                                            case "May":
                                                                valActGpPer = (stkGroupItem.GP_ACT05 / stkGroupItem.ACT05) * 100;
                                                                break;
                                                            case "Jun":
                                                                valActGpPer = (stkGroupItem.GP_ACT06 / stkGroupItem.ACT06) * 100;
                                                                break;
                                                            case "Jul":
                                                                valActGpPer = (stkGroupItem.GP_ACT07 / stkGroupItem.ACT07) * 100;
                                                                break;
                                                            case "Aug":
                                                                valActGpPer = (stkGroupItem.GP_ACT08 / stkGroupItem.ACT08) * 100;
                                                                break;
                                                            case "Sep":
                                                                valActGpPer = (stkGroupItem.GP_ACT09 / stkGroupItem.ACT09) * 100;
                                                                break;
                                                            case "Oct":
                                                                valActGpPer = (stkGroupItem.GP_ACT10 / stkGroupItem.ACT10) * 100;
                                                                break;
                                                            case "Nov":
                                                                valActGpPer = (stkGroupItem.GP_ACT11 / stkGroupItem.ACT11) * 100;
                                                                break;
                                                            case "Dec":
                                                                valActGpPer = (stkGroupItem.GP_ACT12 / stkGroupItem.ACT12) * 100;
                                                                break;
                                                            default:
                                                                valActGpPer = 0;
                                                                break;
                                                        }
                                                        nameActGpPer = "act_gp_" + @stkGroupItem.SEC + "_" + countActGp;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (!Double.IsNaN(valActGpPer) && valActGpPer != 0)
                                                            {
                                                                sizeActValGpPer = valActGpPer.ToString("N2").Length;
                                                                @valActGpPer.ToString("N2").Insert(sizeActValGpPer, "%");
                                                            }

                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="act_gp_per_@countActGpPer" name="@nameActGpPer" id="act_gp_per_@countActGpPer" value="@valActGpPer.ToString("N0")%" />
                                                        </td>
                                                    }
                                                    idAccBudgetGpSumTotal = "act_gp_per_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    //sum total act gp per
                                                    double valSumActGpPer = 0;
                                                    valSumActGpPer = (stkGroupItem.GP_ACT00 / stkGroupItem.ACT00) * 100;
                                                    <td class="vcenter">
                                                        @if (!Double.IsNaN(valSumActGpPer) && valSumActGpPer != 0)
                                                        {
                                                            valSumActGpPer = valSumActGpPer;
                                                        }
                                                        else
                                                        {
                                                            valSumActGpPer = 0;
                                                        }
                                                        <input class="form-control vright act_gp_per_sum_total" type="text" id="@idAccBudgetGpSumTotal" value="@valSumActGpPer.ToString("N2")%" style="width: 120px;" disabled />
                                                    </td>
                                                }
                                            </tr>

                                            <tr>
                                                <th style="vertical-align:middle;">Sale Forecast</th>
                                                @*<td>  </td>*@
                                                @{
                                                    int countSaleForcast = 0;
                                                    string idSaleForecastSumTotal = "";
                                                    string nameSaleForecast = "";
                                                    foreach (var item in arrMonth)
                                                    {
                                                        countSaleForcast++;
                                                        double valSaleForecast = 0;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valSaleForecast = stkGroupItem.FCS01;
                                                                break;
                                                            case "Feb":
                                                                valSaleForecast = stkGroupItem.FCS02;
                                                                break;
                                                            case "Mar":
                                                                valSaleForecast = stkGroupItem.FCS03;
                                                                break;
                                                            case "Apr":
                                                                valSaleForecast = stkGroupItem.FCS04;
                                                                break;
                                                            case "May":
                                                                valSaleForecast = stkGroupItem.FCS05;
                                                                break;
                                                            case "Jun":
                                                                valSaleForecast = stkGroupItem.FCS06;
                                                                break;
                                                            case "Jul":
                                                                valSaleForecast = stkGroupItem.FCS07;
                                                                break;
                                                            case "Aug":
                                                                valSaleForecast = stkGroupItem.FCS08;
                                                                break;
                                                            case "Sep":
                                                                valSaleForecast = stkGroupItem.FCS09;
                                                                break;
                                                            case "Oct":
                                                                valSaleForecast = stkGroupItem.FCS10;
                                                                break;
                                                            case "Nov":
                                                                valSaleForecast = stkGroupItem.FCS11;
                                                                break;
                                                            case "Dec":
                                                                valSaleForecast = stkGroupItem.FCS12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameSaleForecast = "sale_forecast_" + @stkGroupItem.SEC + "_" + countSaleForcast;
                                                        <td class="vright" style="vertical-align: middle;">
                                                            @if (valSaleForecast != 0)
                                                            {
                                                                @valSaleForecast.ToString("N0")
                                                            }
                                                            <input data-id="@stkGroupItem.SEC" type="hidden" class="form-control vright sale_forecast_@countSaleForcast" name="@nameSaleForecast" id="sale_forecast_@countSaleForcast" value="@valSaleForecast.ToString("N0")" />
                                                        </td>
                                                    }
                                                    //sum total actual
                                                    idSaleForecastSumTotal = "sale_forecast_sum_total_" + @stkGroupItem.SEC + "_0";
                                                    <td class="vcenter"> <input class="form-control vright sale_forecast_sum_total" type="text" id="@idSaleForecastSumTotal" value="@stkGroupItem.FCS00.ToString("N0")" style="width: 120px;" disabled /> </td>
                                                }
                                            </tr>

                                            <tr style="background-color: #ccebedc9;">
                                                <th style="vertical-align:middle;">Forecast</th>
                                                @*<td>  </td>*@
                                                @{
                                                    double valPmForecast = 0;
                                                    int countPmForecast = 0;
                                                    string namePmForecast = "";
                                                    string idPmForecastSumTotal = "";
                                                    foreach (var item in arrMonth)
                                                    {

                                                        countPmForecast++;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valPmForecast = stkGroupItem.FC01;
                                                                break;
                                                            case "Feb":
                                                                valPmForecast = stkGroupItem.FC02;
                                                                break;
                                                            case "Mar":
                                                                valPmForecast = stkGroupItem.FC03;
                                                                break;
                                                            case "Apr":
                                                                valPmForecast = stkGroupItem.FC04;
                                                                break;
                                                            case "May":
                                                                valPmForecast = stkGroupItem.FC05;
                                                                break;
                                                            case "Jun":
                                                                valPmForecast = stkGroupItem.FC06;
                                                                break;
                                                            case "Jul":
                                                                valPmForecast = stkGroupItem.FC07;
                                                                break;
                                                            case "Aug":
                                                                valPmForecast = stkGroupItem.FC08;
                                                                break;
                                                            case "Sep":
                                                                valPmForecast = stkGroupItem.FC09;
                                                                break;
                                                            case "Oct":
                                                                valPmForecast = stkGroupItem.FC10;
                                                                break;
                                                            case "Nov":
                                                                valPmForecast = stkGroupItem.FC11;
                                                                break;
                                                            case "Dec":
                                                                valPmForecast = stkGroupItem.FC12;
                                                                break;
                                                            case "Jan Nxt":
                                                                valPmForecast = stkGroupItem.FC13;
                                                                break;
                                                            case "Feb Nxt":
                                                                valPmForecast = stkGroupItem.FC14;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        namePmForecast = "pm_forecast_" + @stkGroupItem.SEC + "_" + countPmForecast;
                                                        <td class="vcenter" style="vertical-align: middle;">
                                                            <input data-month="@countPmForecast" data-stkgroup="@stkGroupItem.SEC" type="text" class="form-control mask vright pm_forecast_@countPmForecast" name="@namePmForecast" id="pm_forecast_@countPmForecast" value="@valPmForecast.ToString("N0")" onkeyup="return sumPmForecastId(this.id, '@stkGroupItem.SEC', 'forecast');" onkeypress="return validateFloatKeyPress(this,event);" style="width: 120px;" />
                                                        </td>

                                                    }
                                                    idPmForecastSumTotal = "pm_forecast_" + @stkGroupItem.SEC + "_0";
                                                    //budget sum total
                                                    <td class="vcenter"> <input class="form-control vright pm_forecast_sum_total" type="text" id="@idPmForecastSumTotal" name="@idPmForecastSumTotal" value="@stkGroupItem.FC00.ToString("N0")" style="width: 120px;" disabled /> </td>
                                                }
                                            </tr>

                                            <tr style="background-color: #ccebedc9;">
                                                <th style="vertical-align:middle;">Forecast GP</th>
                                                @*<td>  </td>*@
                                                @{
                                                    double valPmForecastGp = 0;
                                                    int countPmForecastGp = 0;
                                                    string namePmForecastGp = "";
                                                    string idPmForecastGpSumTotal = "";
                                                    foreach (var item in arrMonth)
                                                    {

                                                        countPmForecastGp++;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valPmForecastGp = stkGroupItem.FC_GP01;
                                                                break;
                                                            case "Feb":
                                                                valPmForecastGp = stkGroupItem.FC_GP02;
                                                                break;
                                                            case "Mar":
                                                                valPmForecastGp = stkGroupItem.FC_GP03;
                                                                break;
                                                            case "Apr":
                                                                valPmForecastGp = stkGroupItem.FC_GP04;
                                                                break;
                                                            case "May":
                                                                valPmForecastGp = stkGroupItem.FC_GP05;
                                                                break;
                                                            case "Jun":
                                                                valPmForecastGp = stkGroupItem.FC_GP06;
                                                                break;
                                                            case "Jul":
                                                                valPmForecastGp = stkGroupItem.FC_GP07;
                                                                break;
                                                            case "Aug":
                                                                valPmForecastGp = stkGroupItem.FC_GP08;
                                                                break;
                                                            case "Sep":
                                                                valPmForecastGp = stkGroupItem.FC_GP09;
                                                                break;
                                                            case "Oct":
                                                                valPmForecastGp = stkGroupItem.FC_GP10;
                                                                break;
                                                            case "Nov":
                                                                valPmForecastGp = stkGroupItem.FC_GP11;
                                                                break;
                                                            case "Dec":
                                                                valPmForecastGp = stkGroupItem.FC_GP12;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        namePmForecastGp = "pm_forecast_gp_" + @stkGroupItem.SEC + "_" + countPmForecastGp;
                                                        <td class="vcenter" style="vertical-align: middle;">
                                                            <input data-month="@countPmForecastGp" data-stkgroup="@stkGroupItem.SEC" type="text" class="form-control mask vright pm_forecast_gp_@countPmForecastGp" name="@namePmForecastGp" id="pm_forecast_gp_@countPmForecastGp" value="@valPmForecastGp.ToString("N0")" onkeyup="return sumPmForecastId(this.id, '@stkGroupItem.SEC', 'forecastGp');" onkeypress="return validateFloatKeyPress(this,event);" style="width: 120px;" />
                                                        </td>

                                                    }
                                                    idPmForecastGpSumTotal = "pm_forecast_gp_" + @stkGroupItem.SEC + "_0";
                                                    //budget sum total
                                                    <td class="vcenter"> <input class="form-control vright pm_forecast_gp_sum_total" type="text" id="@idPmForecastGpSumTotal" name="@idPmForecastGpSumTotal" value="@stkGroupItem.FC_GP00.ToString("N0")" style="width: 120px;" disabled /> </td>
                                                }
                                            </tr>
                                            <tr style="background-color: #ccebedc9;">
                                                <th style="vertical-align:middle;">Target Inventory</th>
                                                @*<td>  </td>*@
                                                @{
                                                    double valTarget = 0;
                                                    int countTarget = 0;
                                                    string nameTarget = "";
                                                    string idTargetSumTotal = "";
                                                    foreach (var item in arrMonth)
                                                    {

                                                        countTarget++;
                                                        switch (item)
                                                        {
                                                            case "Jan":
                                                                valTarget = stkGroupItem.TG_INV01;
                                                                break;
                                                            case "Feb":
                                                                valTarget = stkGroupItem.TG_INV02;
                                                                break;
                                                            case "Mar":
                                                                valTarget = stkGroupItem.TG_INV03;
                                                                break;
                                                            case "Apr":
                                                                valTarget = stkGroupItem.TG_INV04;
                                                                break;
                                                            case "May":
                                                                valTarget = stkGroupItem.TG_INV05;
                                                                break;
                                                            case "Jun":
                                                                valTarget = stkGroupItem.TG_INV06;
                                                                break;
                                                            case "Jul":
                                                                valTarget = stkGroupItem.TG_INV07;
                                                                break;
                                                            case "Aug":
                                                                valTarget = stkGroupItem.TG_INV08;
                                                                break;
                                                            case "Sep":
                                                                valTarget = stkGroupItem.TG_INV09;
                                                                break;
                                                            case "Oct":
                                                                valTarget = stkGroupItem.TG_INV10;
                                                                break;
                                                            case "Nov":
                                                                valTarget = stkGroupItem.TG_INV11;
                                                                break;
                                                            case "Dec":
                                                                valTarget = stkGroupItem.TG_INV12;
                                                                break;
                                                            case "Jan Nxt":
                                                                valTarget = stkGroupItem.TG_INV13;
                                                                break;
                                                            case "Feb Nxt":
                                                                valTarget = stkGroupItem.TG_INV14;
                                                                break;
                                                            default:
                                                                // code block
                                                                break;
                                                        }
                                                        nameTarget = "target_" + @stkGroupItem.SEC + "_" + countTarget;
                                                        <td class="vcenter" style="vertical-align: middle;">
                                                            <input data-month="@countTarget" data-stkgroup="@stkGroupItem.SEC" type="text" class="form-control mask vright target_@countTarget" name="@nameTarget" id="target_@countTarget" value="@valTarget.ToString("N0")" onkeyup="return sumPmForecastId(this.id, '@stkGroupItem.SEC', 'target');" onkeypress="return validateFloatKeyPress(this,event);" style="width: 120px;" />
                                                        </td>

                                                    }
                                                    idTargetSumTotal = "target_" + @stkGroupItem.SEC + "_0";
                                                    //budget sum total
                                                    <td class="vcenter"> <input class="form-control vright target_sum_total" type="text" id="@idTargetSumTotal" name="@idTargetSumTotal" value="@stkGroupItem.TG_INV00.ToString("N0")" style="width: 120px;" disabled /> </td>
                                                }
                                            </tr>

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    }//end group
                }
            </div>
        </form>
    </div>
    //Summary
    <div class="card mb-12" id="cardSummary" style="margin-top: 10px;">
        <div class="card-header bg-danger text-white font-weight-bold">
            <div class="row">
                <div class="col-sm-6 text-left">
                    <i class="fa fa-usd"></i> Summary
                </div>
                <div class="col-sm-6 text-right">
                    <button type="button" class="btn btn-info btn-sm" onclick="calculateForecastPm();" style="margin-bottom: -2px; width: 40px;"><i class="fa fa-refresh"></i></button>
                </div>
            </div>
        </div>
        <div class="card-body" style="padding: 0px 0px;">
            <div class="table-responsive">
                <table class="dataTablePage table table-striped table-bordered nowrap table-hover tableFixHead" border="1">
                    <thead>
                        <tr style="white-space: nowrap;">
                            <th class="vleft" style="vertical-align: middle;">Month/Topic</th>
                            @*<th class="vcenter" style="vertical-align: middle; min-width: 130px;">Begin</th>*@
                            @{
                                foreach (var item in arrMonth)
                                {
                                    <th class="vcenter" align="center" style="font-weight: 700; min-width: 140px;"> @item </th>
                                }
                            }
                            <th class="vcenter" style="vertical-align: middle; min-width: 130px;">Sum Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="white-space: nowrap;">
                            <th>Budget</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_budget_@colTdSum"> </span>
                                    </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_budget_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Accum Budget</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_acc_budget_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_acc_budget_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Budget GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_budget_gp_@colTdSum"> </span>
                                        <input type="hidden" id="val_sum_budget_gp_@colTdSum" value="" />
                                    </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_budget_gp_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Accum Bdg GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_acc_budget_gp_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_acc_budget_gp_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>%Budget GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_budget_gp_per_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_budget_gp_per_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Actual</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_act_@colTdSum"> </span>
                                        <input type="hidden" id="val_sum_act_@colTdSum" value="" />
                                    </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_act_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Accum Actual</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_acc_act_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_acc_act_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Actual GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_act_gp_@colTdSum"> </span>
                                        <input type="hidden" id="val_sum_act_gp_@colTdSum" value="" />
                                    </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_act_gp_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Accum Act GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_acc_act_gp_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_acc_act_gp_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>%Actual GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_act_gp_per_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_act_gp_per_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap;">
                            <th>Sale Forecast</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 13; colTdSum++)
                                {
                                    <td class="vright"> <span id="sum_sale_forecast_@colTdSum"> </span> </td>
                                }
                                <td> </td>
                                <td> </td>
                                <td class="vright"> <span id="sum_sale_forecast_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap; background-color: #ccebedc9;">
                            <th>Forecast</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 15; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_pm_forecast_@colTdSum"> </span>
                                        <input type="hidden" id="val_sum_pm_forecast_@colTdSum" value="" />
                                    </td>
                                }
                                <td class="vright"> <span id="sum_pm_forecast_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap; background-color: #ccebedc9;">
                            <th>Forecast GP</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 15; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_pm_forecast_gp_@colTdSum"> </span>
                                        <input type="hidden" id="val_sum_pm_forecast_gp_@colTdSum" value="" />
                                    </td>
                                }

                                <td class="vright"> <span id="sum_pm_forecast_gp_sum_total"> </span> </td>
                            }
                        </tr>
                        <tr style="white-space: nowrap; background-color: #ccebedc9;">
                            <th>Target Inventory</th>
                            @{
                                for (int colTdSum = 1; colTdSum < 15; colTdSum++)
                                {
                                    <td class="vright">
                                        <span id="sum_target_@colTdSum"> </span>
                                        <input type="hidden" id="val_sum_target_@colTdSum" value="" />
                                    </td>
                                }
                                <td class="vright"> <span id="sum_target_sum_total"> </span> </td>
                            }
                        </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
}
<script defer>
    var countList = $("#countList").val() || 0;
    if (countList > 0) {
        $('#formForecastPm').data('serialize', $('#formForecastPm').serialize()); // On load save form current
        $(window).bind('beforeunload', function (e) {
            if ($('#formForecastPm').serialize() != $('#formForecastPm').data('serialize')) {
                return true;
            } else {
                e = null;
            }
        });
    }
    //hide/show tab
    function hideBodySec(sec) {
        var x = document.getElementById("body_" + sec);
        if (x.style.display === "none") {
            $("#header_" + sec).toggleClass("fa-caret-up fa-caret-down");
            $("#body_" + sec).show('fast');
        } else {
            $("#header_" + sec).toggleClass("fa-caret-down fa-caret-up");
            $("#body_" + sec).hide('fast');
        }
    }
    //btn save
    saveForecastPm = async () => {
        var request = [];
        var year = $("#year option:selected").val();
        Swal.fire({
            title: 'ยืนยันการบันทึกข้อมูล',
            // html: html,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#00a65a',
            cancelButtonColor: '#d33',
            confirmButtonText: '<i class="fa fa-check"></i> ยืนยัน',
            cancelButtonText: '<i class="fa fa-times"></i> ไม่',
            allowOutsideClick: false,
            focusConfirm: false,
        }).then((result) => {
            if (result.value) {
                $('.stkSecList_header').each(function () {
                    var sec;
                    sec = $(this).val();
                    if (sec != null) {
                        var details = {
                            USER: '@Session["UserID"]',
                            SEC: sec,
                            YEAR: year,
                            FC00: parseInt($("input[name=pm_forecast_" + sec + "_0]").val().replace(/\,/g, '')),
                            FC01: parseInt($("input[name=pm_forecast_" + sec + "_1]").val().replace(/\,/g, '')),
                            FC02: parseInt($("input[name=pm_forecast_" + sec + "_2]").val().replace(/\,/g, '')),
                            FC03: parseInt($("input[name=pm_forecast_" + sec + "_3]").val().replace(/\,/g, '')),
                            FC04: parseInt($("input[name=pm_forecast_" + sec + "_4]").val().replace(/\,/g, '')),
                            FC05: parseInt($("input[name=pm_forecast_" + sec + "_5]").val().replace(/\,/g, '')),
                            FC06: parseInt($("input[name=pm_forecast_" + sec + "_6]").val().replace(/\,/g, '')),
                            FC07: parseInt($("input[name=pm_forecast_" + sec + "_7]").val().replace(/\,/g, '')),
                            FC08: parseInt($("input[name=pm_forecast_" + sec + "_8]").val().replace(/\,/g, '')),
                            FC09: parseInt($("input[name=pm_forecast_" + sec + "_9]").val().replace(/\,/g, '')),
                            FC10: parseInt($("input[name=pm_forecast_" + sec + "_10]").val().replace(/\,/g, '')),
                            FC11: parseInt($("input[name=pm_forecast_" + sec + "_11]").val().replace(/\,/g, '')),
                            FC12: parseInt($("input[name=pm_forecast_" + sec + "_12]").val().replace(/\,/g, '')),
                            FC12: parseInt($("input[name=pm_forecast_" + sec + "_12]").val().replace(/\,/g, '')),
                            FC13: parseInt($("input[name=pm_forecast_" + sec + "_13]").val().replace(/\,/g, '')),
                            FC14: parseInt($("input[name=pm_forecast_" + sec + "_14]").val().replace(/\,/g, '')),

                            FC_GP00: parseInt($("input[name=pm_forecast_gp_" + sec + "_0]").val().replace(/\,/g, '')),
                            FC_GP01: parseInt($("input[name=pm_forecast_gp_" + sec + "_1]").val().replace(/\,/g, '')),
                            FC_GP02: parseInt($("input[name=pm_forecast_gp_" + sec + "_2]").val().replace(/\,/g, '')),
                            FC_GP03: parseInt($("input[name=pm_forecast_gp_" + sec + "_3]").val().replace(/\,/g, '')),
                            FC_GP04: parseInt($("input[name=pm_forecast_gp_" + sec + "_4]").val().replace(/\,/g, '')),
                            FC_GP05: parseInt($("input[name=pm_forecast_gp_" + sec + "_5]").val().replace(/\,/g, '')),
                            FC_GP06: parseInt($("input[name=pm_forecast_gp_" + sec + "_6]").val().replace(/\,/g, '')),
                            FC_GP07: parseInt($("input[name=pm_forecast_gp_" + sec + "_7]").val().replace(/\,/g, '')),
                            FC_GP08: parseInt($("input[name=pm_forecast_gp_" + sec + "_8]").val().replace(/\,/g, '')),
                            FC_GP09: parseInt($("input[name=pm_forecast_gp_" + sec + "_9]").val().replace(/\,/g, '')),
                            FC_GP10: parseInt($("input[name=pm_forecast_gp_" + sec + "_10]").val().replace(/\,/g, '')),
                            FC_GP11: parseInt($("input[name=pm_forecast_gp_" + sec + "_11]").val().replace(/\,/g, '')),
                            FC_GP12: parseInt($("input[name=pm_forecast_gp_" + sec + "_12]").val().replace(/\,/g, '')),
                            FC_GP13: parseInt($("input[name=pm_forecast_gp_" + sec + "_13]").val().replace(/\,/g, '')),
                            FC_GP14: parseInt($("input[name=pm_forecast_gp_" + sec + "_14]").val().replace(/\,/g, '')),

                            TG_INV00: parseInt($("input[name=target_" + sec + "_0]").val().replace(/\,/g, '')),
                            TG_INV01: parseInt($("input[name=target_" + sec + "_1]").val().replace(/\,/g, '')),
                            TG_INV02: parseInt($("input[name=target_" + sec + "_2]").val().replace(/\,/g, '')),
                            TG_INV03: parseInt($("input[name=target_" + sec + "_3]").val().replace(/\,/g, '')),
                            TG_INV04: parseInt($("input[name=target_" + sec + "_4]").val().replace(/\,/g, '')),
                            TG_INV05: parseInt($("input[name=target_" + sec + "_5]").val().replace(/\,/g, '')),
                            TG_INV06: parseInt($("input[name=target_" + sec + "_6]").val().replace(/\,/g, '')),
                            TG_INV07: parseInt($("input[name=target_" + sec + "_7]").val().replace(/\,/g, '')),
                            TG_INV08: parseInt($("input[name=target_" + sec + "_8]").val().replace(/\,/g, '')),
                            TG_INV09: parseInt($("input[name=target_" + sec + "_9]").val().replace(/\,/g, '')),
                            TG_INV10: parseInt($("input[name=target_" + sec + "_10]").val().replace(/\,/g, '')),
                            TG_INV11: parseInt($("input[name=target_" + sec + "_11]").val().replace(/\,/g, '')),
                            TG_INV12: parseInt($("input[name=target_" + sec + "_12]").val().replace(/\,/g, '')),
                            TG_INV13: parseInt($("input[name=target_" + sec + "_13]").val().replace(/\,/g, '')),
                            TG_INV14: parseInt($("input[name=target_" + sec + "_14]").val().replace(/\,/g, '')),

                        }
                        request.push(details);
                    }
                });
                console.log(request);
                //return false;
                $.ajax({
                    type: 'POST',
                    cache: false,
                    url: '@Url.Action("SaveForecast", "ForecastPm")',
                    data: JSON.stringify(request),
                    contentType: "application/json; charset=utf-8",
                    enctype: 'multipart/form-data',
                    beforeSend: function () {
                        LoadingShow();
                    },
                    success: function (result) {
                        if (result != null) {
                            //disbled beforeunload
                            $(window).unbind('beforeunload');
                            Swal.fire({
                                title: 'บันทึกเรียบร้อย',
                                //html: 'บันทึกเรียบร้อย',
                                icon: 'success',
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'ปิด',
                                allowOutsideClick: false,
                                focusConfirm: false,
                                timer: 6000,
                                timerProgressBar: true,
                                onClose: () => {
                                    $(window).unbind('beforeunload');
                                    LoadingHide();
                                    $('form[id="forecastPmForm"]').submit();
                                }
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                //title: res.msg,
                                html: 'พบข้อผิดพลาด',
                                confirmButtonColor: '#d33',
                                confirmButtonText: 'ปิด',
                                allowOutsideClick: false,
                                focusConfirm: false,
                            });
                        }
                    },
                    error: function (ex) {
                        //notify(ex, 'danger');
                    },
                    complete: function (res) {
                        LoadingHide();
                    }
                }).fail(function (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'ระบบทำงานผิดพลาด()',
                        html: 'กรุณาแจ้งผู้ดูแลระบบ<br>โดยการแคปหน้าจอและก๊อปปี้ Error ด่านล่างนี้<br>saveForcastPm<br><br>',
                        confirmButtonColor: '#d33',
                        confirmButtonText: 'ปิด',
                        allowOutsideClick: false,
                        focusConfirm: false,
                    });
                });
            }
        });
    }
    //sum forecast, forecast gp
    const sumForecast = async () => {
        $('.stkSecList_header').each(function () {
            var sec;
            sec = $(this).val();
            if (sec != null) {
                sumPmForecastId('pm_forecast_1', sec, 'forecast');
                sumPmForecastId('pm_forecast_gp_1', sec, 'forecastGp');
                sumPmForecastId('sale_forecast_1', sec, 'saleForecast');
                sumPmForecastId('target_1', sec, 'target');
            }
        });
    }
    //sum forecast by input
    const sumPmForecastId = async (_className, sec, flag) => {
        let sum_forecast_by_pm = 0;
        //_id = pm_forecast
        await Promise.all($('.' + _className).each(async function (i, obj) {
            let forecast_by_pm = obj.value.toString().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
            forecast_by_pm = await getVowels(forecast_by_pm, 0);
            sum_forecast_by_pm += Number(forecast_by_pm);
            //console.log(sum_budget_by_pm);
        }));
        if (sum_forecast_by_pm != 0) {
            $('#sum_' + _className).text(numberWithCommas(sum_forecast_by_pm));
            $('#val_sum_' + _className).val(numberWithCommas(sum_forecast_by_pm));
        }

        if (flag == "forecast") {//sum total forecast
            let sum_forecast_by_pm_sum_total = 0;
            for (let numMonth = 1; numMonth <= 14; numMonth++) {
                await Promise.all($("input[name=pm_forecast_" + sec + "_" + numMonth + "]").each(async function (i, obj) {
                    let budget_by_pm = obj.value.toString().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
                    budget_by_pm = await getVowels(budget_by_pm, 0);
                    sum_forecast_by_pm_sum_total += Number(budget_by_pm);

                    //console.log("budget_by_pm_" + sec + '_' + numMonth +' = ' + budget_by_pm);
                }));
            }
            $("#pm_forecast_" + sec + "_0").val(numberWithCommas(sum_forecast_by_pm_sum_total));
            //console.log("sum_forecast_by_pm_sum_total" + sec + ' = '  + sum_forecast_by_pm_sum_total);
            //sum ข้างล่าง
            await sumPmForecastSumTotal("pm_forecast_sum_total");
        } else if (flag == "forecastGp") {//sum total forecast gp
            let sum_forecast_gp_sum_total = 0;
            for (let numMonth = 1; numMonth <= 14; numMonth++) {
                await Promise.all($("input[name=pm_forecast_gp_" + sec + "_" + numMonth + "]").each(async function (i, obj) {
                    let forecast_gp = obj.value.toString().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
                    forecast_gp = await getVowels(forecast_gp, 0);
                    sum_forecast_gp_sum_total += Number(forecast_gp);
                }));
            }
            $("#pm_forecast_gp_" + sec + "_0").val(numberWithCommas(sum_forecast_gp_sum_total));
            //sum ข้างล่าง
            await sumPmForecastSumTotal("pm_forecast_gp_sum_total");
        } else if (flag == "saleForecast") {//sum total sale forecast
            let sum_forecast_by_pm_sum_total = 0;
            for (let numMonth = 1; numMonth <= 14; numMonth++) {
                await Promise.all($("input[name=sale_forecast_" + sec + "_" + numMonth + "]").each(async function (i, obj) {
                    let budget_by_pm = obj.value.toString().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
                    budget_by_pm = await getVowels(budget_by_pm, 0);
                    sum_forecast_by_pm_sum_total += Number(budget_by_pm);
                }));
            }
            $("#sale_forecast_sum_total_" + sec + "_0").val(numberWithCommas(sum_forecast_by_pm_sum_total));
            //sum ข้างล่าง
            await sumPmForecastSumTotal("sale_forecast_sum_total");
        } else if (flag == "target") {//sum total target
            let sum_forecast_by_pm_sum_total = 0;
            for (let numMonth = 1; numMonth <= 14; numMonth++) {
                await Promise.all($("input[name=target_" + sec + "_" + numMonth + "]").each(async function (i, obj) {
                    let budget_by_pm = obj.value.toString().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
                    budget_by_pm = await getVowels(budget_by_pm, 0);
                    sum_forecast_by_pm_sum_total += Number(budget_by_pm);
                }));
            }
            $("#target_" + sec + "_0").val(numberWithCommas(sum_forecast_by_pm_sum_total));
            //sum ข้างล่าง
            await sumPmForecastSumTotal("target_sum_total");
        }
    }

    //sum gp budget
    const sumTotalGpBudgetPer = async () => {
        for (let numMonth = 1; numMonth <= 12; numMonth++) {
            let sum_total_budget_gp_per = 0;
            let sum_budget_gp = $("#sum_budget_gp_" + numMonth).text().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
            let sum_budget_by_pm = $("#sum_budget_" + numMonth).text().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
            if (sum_budget_by_pm != 0) {
                sum_total_budget_gp_per = (sum_budget_gp / sum_budget_by_pm) * 100;
            }
            if (sum_total_budget_gp_per != 0) {
                $('#sum_budget_gp_per_' + numMonth).text(sum_total_budget_gp_per.toFixed(0) + "%");
            }
        }
        let sum_all_total_budget_gp_per = 0;
        let sum_all_budget_gp = $("#sum_budget_gp_sum_total").text().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
        let sum_all_budget_by_pm = $("#sum_budget_sum_total").text().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
        if (sum_all_budget_by_pm != 0) {
            sum_all_total_budget_gp_per = (sum_all_budget_gp / sum_all_budget_by_pm) * 100;
        }
        $('#sum_budget_gp_per_sum_total').text(sum_all_total_budget_gp_per.toFixed(0) + "%");
    }
    //sum actual budget
    const sumTotalActaulPer = async () => {
        for (let numMonth = 1; numMonth <= 12; numMonth++) {
            let sum_total_budget_gp_per = 0;
            let sum_budget_gp = $("#val_sum_act_gp_" + numMonth).val().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
            let sum_budget_by_pm = $("#val_sum_act_" + numMonth).val().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
            if (sum_budget_by_pm != 0) {
                sum_total_budget_gp_per = (sum_budget_gp / sum_budget_by_pm) * 100;
                $('#sum_act_gp_per_' + numMonth).text(sum_total_budget_gp_per.toFixed(2) + "%");
            }
        }
        //summary
        let sum_total_all_budget_gp_per = 0;
        let sum_total_budget_by_pm = $("#sum_act_gp_sum_total").text().replace(/([-[\]{}()*+?.\\^$|%,])/g, '') || 0;
        let sum_total_budget_gp = $("#sum_act_sum_total").text().replace(/([-[\]{}()*+?.\\^$|%,])/g, '') || 0;
        //console.log("sum_total_budget_by_pm = " + sum_total_budget_by_pm);
        //console.log("sum_total_budget_gp = " + sum_total_budget_gp);
        if (sum_total_budget_gp != 0) {
            sum_total_all_budget_gp_per = (sum_total_budget_by_pm / sum_total_budget_gp) * 100;
        }
        $('#sum_act_gp_per_sum_total').text(sum_total_all_budget_gp_per.toFixed(2) + "%");
    }
    //sum Budget By field name
    const sumBudgetField = async (inputName) => {
        let txtPercent = "";
        if (inputName == "budget_gp_per" || inputName == "act_gp_per") {
            txtPercent = "%";
        }
        for (let numMonth = 0; numMonth <= 14; numMonth++) {
            let sum_budget = 0;
            await Promise.all($('.' + inputName + '_' + numMonth).each(async function (i, obj) {
                let budget_by_pm = obj.value.toString().replace(/([-[\]{}()*+?\\^$|%,])/g, '');

                budget_by_pm = await getVowels(budget_by_pm, 0);
                sum_budget += Number(budget_by_pm);
            }));
            if (sum_budget != 0 && sum_budget != null) {
                $('#sum_' + inputName + '_' + numMonth).text(numberWithCommas(sum_budget) + txtPercent);
                $('#val_sum_' + inputName + '_' + numMonth).val(numberWithCommas(sum_budget));
            }
        }
    }
    //sum PM Forecast
    const sumPmForecastSumTotal = async (inputName) => {
        let budget_sum_total = 0;
        await Promise.all($('.' + inputName).each(async function (i, obj) {
            let budget_by_pm = obj.value.toString().replace(/([-[\]{}()*+?.\\^$|%,])/g, '');
            budget_by_pm = await getVowels(budget_by_pm, 0);
            budget_sum_total += Number(budget_by_pm);
        }));
        if (budget_sum_total != 0) {
            $('#sum_' + inputName).text(numberWithCommas(budget_sum_total));
        }
    }
    //btn reload
    async function calculateForecastPm() {
        $("#cardSummary").LoadingOverlay("show");

        await sumBudgetField("pm_forecast");
        await sumBudgetField("pm_forecast_gp");
        await sumBudgetField("budget");
        await sumBudgetField("acc_budget");
        await sumBudgetField("act");
        await sumBudgetField("acc_act");
        await sumBudgetField("sale_forecast");
        await sumBudgetField("budget_gp");
        await sumBudgetField("acc_budget_gp");
        await sumBudgetField("act_gp");
        await sumBudgetField("acc_act_gp");
        await sumBudgetField("target");

        //Pm forecast
        await sumPmForecastSumTotal("budget_sum_total");
        await sumPmForecastSumTotal("acc_budget_sum_total");
        await sumPmForecastSumTotal("acc_act_sum_total");
        await sumPmForecastSumTotal("sale_forecast_sum_total");
        await sumPmForecastSumTotal("budget_gp_sum_total");
        await sumPmForecastSumTotal("act_sum_total");
        await sumPmForecastSumTotal("pm_forecast_sum_total");
        await sumPmForecastSumTotal("pm_forecast_gp_sum_total");
        await sumPmForecastSumTotal("acc_budget_gp_sum_total");
        await sumPmForecastSumTotal("act_gp_sum_total");
        await sumPmForecastSumTotal("acc_act_gp_sum_total");
        await sumPmForecastSumTotal("target_sum_total");

        await sumForecast();
        await sumTotalGpBudgetPer();
        await sumTotalActaulPer();

        await $("#cardSummary").LoadingOverlay("hide");
    }

    $(document).ready(function () {
        calculateForecastPm();
    });
</script>
